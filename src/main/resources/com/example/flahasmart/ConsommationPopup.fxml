<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<AnchorPane style="-fx-background-color: transparent;" stylesheets="@css/style.css" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.example.flahasmart.controllers.ConsommationPopupController">

    <VBox maxWidth="550" prefWidth="500" spacing="0" styleClass="compact-popup" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0">

        <!-- Header compact -->
        <VBox alignment="CENTER" prefHeight="44.0" prefWidth="496.0" spacing="4" styleClass="compact-header">
            <FontIcon iconColor="white" iconLiteral="fas-seedling" iconSize="32" />
            <Label styleClass="compact-title" text="Gestion Consommation" />
            <Label fx:id="productNameLabel" styleClass="compact-subtitle" text="Produit sélectionné" />
        </VBox>

        <!-- Contenu compact -->
        <VBox prefHeight="548.0" prefWidth="443.0" spacing="12" styleClass="compact-content" VBox.vgrow="ALWAYS">
            <padding>
                <Insets bottom="15" left="15" right="15" top="15" />
            </padding>

            <!-- Formulaire compact -->
            <VBox prefHeight="226.0" prefWidth="484.0" spacing="12" styleClass="compact-form">

                <!-- Ligne Surface -->
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <FontIcon iconColor="#4CAF50" iconLiteral="fas-map-marked-alt" iconSize="14" />
                    <Label prefWidth="70" styleClass="compact-label" text="Surface:" />
                    <TextField fx:id="surfaceField" prefWidth="83.0" promptText="0.00" styleClass="compact-input" HBox.hgrow="ALWAYS" />
                    <Label prefHeight="14.0" prefWidth="41.0" styleClass="compact-unit" text="m²" />
   
                   <!-- Ligne Quantité -->
                   <HBox alignment="CENTER_LEFT" prefHeight="40.0" prefWidth="255.0" spacing="8">
                       <FontIcon iconColor="#4CAF50" iconLiteral="fas-weight" iconSize="14" />
                       <Label prefWidth="70" styleClass="compact-label" text="Quantité:" />
                       <TextField fx:id="quantiteField" prefWidth="100" promptText="0.00" styleClass="compact-input" />
                       <ComboBox fx:id="uniteCombo" prefHeight="36.0" prefWidth="87.0" styleClass="compact-input">
                           <items>
                               <FXCollections fx:factory="observableArrayList">
                                   <String fx:value="kg" />
                                   <String fx:value="g" />
                                   <String fx:value="L" />
                                   <String fx:value="ml" />
                                   <String fx:value="pièce" />
                               </FXCollections>
                           </items>
                       </ComboBox>
                   </HBox>
                </HBox>

                <!-- Ligne Dates -->
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <FontIcon iconColor="#4CAF50" iconLiteral="fas-calendar-alt" iconSize="14" />
                    <Label prefHeight="14.0" prefWidth="59.0" styleClass="compact-label" text="Récolte:" />
                    <DatePicker fx:id="dateRecoltePicker" prefHeight="50.0" prefWidth="143.0" styleClass="compact-datepicker" HBox.hgrow="ALWAYS" />
   
                   <HBox alignment="CENTER_LEFT" prefHeight="50.0" prefWidth="259.0" spacing="8">
                       <FontIcon iconColor="#4CAF50" iconLiteral="fas-calendar-check" iconSize="14" />
                       <Label prefWidth="70" styleClass="compact-label" text="Utilisation:" />
                       <DatePicker fx:id="dateUtilisationPicker" prefHeight="50.0" prefWidth="129.0" styleClass="compact-datepicker" HBox.hgrow="ALWAYS" />
                   </HBox>
                </HBox>
            <HBox alignment="CENTER" prefHeight="100.0" prefWidth="200.0">
               <children>
                      <Button fx:id="clearBtn" onAction="#clearForm" prefWidth="120" styleClass="compact-btn-secondary">
                          <graphic>
                              <FontIcon iconColor="white" iconLiteral="fas-undo-alt" iconSize="12" />
                          </graphic>
                          Effacer
                      </Button>
                  <Region prefHeight="30.0" prefWidth="24.0" />
                      <Button fx:id="saveBtn" onAction="#saveConsommation" prefWidth="120" styleClass="compact-btn-primary">
                          <graphic>
                              <FontIcon iconColor="white" iconLiteral="fas-save" iconSize="12" />
                          </graphic>
                          Enregistrer
                      </Button>
               </children>
            </HBox>
            </VBox>

            <!-- Séparateur mince -->
            <HBox alignment="CENTER" spacing="5">
                <Region styleClass="compact-line" />
                <Region styleClass="compact-line" />
            </HBox>

            <!-- Liste compacte -->
            <VBox spacing="8" VBox.vgrow="ALWAYS">
                <Label styleClass="compact-section-title" text="Historique">
                    <graphic>
                        <FontIcon iconColor="#4CAF50" iconLiteral="fas-history" iconSize="12" />
                    </graphic>
                </Label>

                <ListView fx:id="consumptionListView" prefHeight="150" styleClass="compact-listview">
                    <placeholder>
                        <VBox alignment="CENTER" prefHeight="139.0" prefWidth="462.0" spacing="5">
                            <FontIcon iconColor="#95a5a6" iconLiteral="fas-box-open" iconSize="24" />
                            <Label styleClass="compact-placeholder" text="Aucune consommation" />
                        </VBox>
                    </placeholder>
                </ListView>
            </VBox>

            <!-- Statistiques compactes -->
            <HBox alignment="CENTER" spacing="8">
                <VBox styleClass="compact-stat">
                    <FontIcon iconColor="#4CAF50" iconLiteral="fas-weight" iconSize="16" />
                    <Label fx:id="totalQuantiteLabel" styleClass="compact-stat-value" text="0" />
                    <Label styleClass="compact-stat-label" text="Total" />
                </VBox>

                <VBox styleClass="compact-stat">
                    <FontIcon iconColor="#3498db" iconLiteral="fas-sort-amount-up" iconSize="16" />
                    <Label fx:id="totalEntriesLabel" styleClass="compact-stat-value" text="0" />
                    <Label styleClass="compact-stat-label" text="Entrées" />
                </VBox>

                <VBox styleClass="compact-stat">
                    <FontIcon iconColor="#e74c3c" iconLiteral="fas-ruler-combined" iconSize="16" />
                    <Label fx:id="totalSurfaceLabel" styleClass="compact-stat-value" text="0" />
                    <Label styleClass="compact-stat-label" text="Surface" />
                </VBox>
            </HBox>

            <!-- Bouton fermer compact -->
            <HBox alignment="CENTER" spacing="8">
                <Button fx:id="closeBtn" onAction="#closePopup" prefWidth="100" styleClass="compact-btn-close">
                    <graphic>
                        <FontIcon iconColor="white" iconLiteral="fas-times" iconSize="12" />
                    </graphic>
                    Fermer
                </Button>
            </HBox>
        </VBox>
    </VBox>
</AnchorPane>
